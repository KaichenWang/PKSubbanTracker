var canVote,messageIsVisible=!1,showMessage=function(s,e){if($(".wrapper").animate({scrollTop:0},200),!messageIsVisible){messageIsVisible=!0,$(".message").toggleClass(s),$(".message h4").text(e),$(".message").toggleClass("show");setTimeout(function(){$(".message").toggleClass("show"),$(".message").toggleClass(s),$(".message h4").text(""),messageIsVisible=!1},2e3)}};function checkCookie(){canVote=!document.cookie||-1==document.cookie.indexOf("PD_poll_9559362")}checkCookie();function onClickVote(s,e){if(stats.selectedSeason().isLatest||"total"===stats.selectedSeason().id)if(canVote){canVote=!1;var t=$(e.srcElement).closest(".container").data("player"),a="subban"===t,o=a?"weber":"subban",n=a?"P.K. Subban":"Shea Weber";a?$("#PDI_answer43654459").prop("checked",!0):$("#PDI_answer43654460").prop("checked",!0),PD_prevote9559362(1);var i=stats.seasons[0][t].votes(),l=stats.seasons[0][o].votes(),p=a?mapPollToObject(i.votes+1,l.votes,0,0):mapPollToObject(l.votes,i.votes+1,0,0);stats.seasons[0][t].votes(p[t].votes),stats.seasons[0][o].votes(p[o].votes);var r=stats.seasons.length-1,u=stats.seasons[r][t].votes(),c=stats.seasons[r][o].votes(),b=a?mapPollToObject(u.votes+1,c.votes,0,0):mapPollToObject(c.votes,u.votes+1,0,0);stats.seasons[r][t].votes(b[t].votes),stats.seasons[r][o].votes(b[o].votes),showMessage("success","+1 vote for "+n)}else showMessage("error","Sorry, you've already voted");else showMessage("error","Voting has ended for "+stats.selectedSeason().name)}var commentClickable=!0;$(".trigger-comments").click(function(){var s=$(this);if(commentClickable){if(commentClickable=!1,s.is("#close-comments")){setTimeout(function(){$("#page-1").addClass("hidden")},500)}else $("#page-1").removeClass("hidden");$("#page-1").toggleClass("slide-in"),$("#page-1").toggleClass("slide-out"),commentClickable=!0}});function StatsModel(){this.seasons=[{id:"r2019",name:"REG. SEASON 2018-2019",isLatest:!1,isPlayoff:!1,subban:{stats:{played:63,goals:9,assists:22,points:31,plusMinus:5},team:{wins:47,losses:29,otLosses:6,points:100,status:""},votes:{votes:126150,percent:76}},weber:{stats:{played:58,goals:14,assists:19,points:33,plusMinus:15},team:{wins:44,losses:30,otLosses:8,points:96,status:""},votes:{votes:40605,percent:24}}},{id:"p2018",name:"PLAYOFFS 2018",isLatest:!1,isPlayoff:!0,subban:{stats:{played:13,goals:4,assists:5,points:9,plusMinus:-2},team:{wins:3,losses:4,otLosses:"",points:"",status:"Round 2"},votes:{votes:179459,percent:72}},weber:{stats:{played:0,goals:0,assists:0,points:0,plusMinus:0},team:{wins:0,losses:0,otLosses:"",points:"",status:"No Playoffs"},votes:{votes:70481,percent:28}}},{id:"r2018",name:"REG. SEASON 2017-2018",isLatest:!1,isPlayoff:!1,subban:{stats:{played:82,goals:16,assists:43,points:59,plusMinus:18},team:{wins:53,losses:18,otLosses:11,points:117,status:""},votes:{votes:106234,percent:64}},weber:{stats:{played:26,goals:6,assists:10,points:16,plusMinus:-8},team:{wins:29,losses:40,otLosses:13,points:71,status:""},votes:{votes:61001,percent:36}}},{id:"p2017",name:"PLAYOFFS 2017",isLatest:!1,isPlayoff:!0,subban:{stats:{played:22,goals:2,assists:10,points:12,plusMinus:5},team:{wins:2,losses:4,otLosses:"",points:"",status:"CUP FINAL"},votes:{votes:12271,percent:64}},weber:{stats:{played:6,goals:1,assists:2,points:3,plusMinus:1},team:{wins:2,losses:4,otLosses:"",points:"",status:"Round 1"},votes:{votes:6870,percent:36}}},{id:"r2016",name:"REG. SEASON 2016-2017",isLatest:!1,isPlayoff:!1,subban:{stats:{played:66,goals:10,assists:30,points:40,plusMinus:-8},team:{wins:41,losses:29,otLosses:12,points:94,status:""},votes:{votes:11433,percent:20}},weber:{stats:{played:78,goals:17,assists:25,points:42,plusMinus:20},team:{wins:47,losses:26,otLosses:9,points:103,status:""},votes:{votes:45061,percent:80}}}],this.isDataLoaded=ko.observable(!1),this.selectedSeason=ko.observable()}var stats=new StatsModel,DATA_URL_SUBBAN_REGULAR="https://statsapi.web.nhl.com/api/v1/people/8474056/stats?stats=yearByYear",DATA_URL_WEBER_REGULAR=DATA_URL_SUBBAN_REGULAR.replace("8474056","8470642"),DATA_URL_SUBBAN_PLAYOFF="https://statsapi.web.nhl.com/api/v1/people/8474056/stats?stats=yearByYearPlayoffs",DATA_URL_WEBER_PLAYOFF=DATA_URL_SUBBAN_PLAYOFF.replace("8474056","8470642"),DATA_URL_LEAGUE="https://statsapi.web.nhl.com/api/v1/standings?expand=standings.record,standings.team&season=20182019",DATA_URL_POLL="https://nhl-tracker-api.now.sh/poll",DATA_URL_PLAYOFF_NASH="https://statsapi.web.nhl.com/api/v1/schedule?startDate=2019-04-01&endDate=2019-07-01&gameType=P&expand=schedule.game.seriesSummary,seriesSummary.series&teamId=18",DATA_URL_PLAYOFF_MONT=DATA_URL_PLAYOFF_NASH.replace("18","8"),STATS_OFFSET={SUBBAN:{played:246,goals:41,assists:110,points:151,plusMinus:18},WEBER:{played:168,goals:38,assists:56,points:94,plusMinus:28}},POLL_OFFSET={SUBBAN:435547,WEBER:224018};$.when(fetch(DATA_URL_SUBBAN_PLAYOFF),fetch(DATA_URL_PLAYOFF_NASH),fetch(DATA_URL_POLL)).done(function(s,e,t){var a=t[0].demand[0].result.answers.answer,o=a[0].total,n=a[1].total,i=mapPollToObject(o,n,POLL_OFFSET.SUBBAN,POLL_OFFSET.WEBER),l=mapPollToObject(o,n,0,0),p={id:"r2019",name:"PLAYOFFS 2019",isLatest:!0,isPlayoff:!0,subban:{stats:mapPlayerDataToArray(s),team:mapLeaguePlayoffDataToObject(e,18),votes:ko.observable(i.subban.votes)},weber:{stats:{played:0,goals:0,assists:0,points:0,plusMinus:0},team:{wins:0,losses:0,otLosses:0,points:0,status:"No Playoffs"},votes:ko.observable(i.weber.votes)}},r={id:"total",name:"TOTALS SINCE TRADE",isLatest:!1,isPlayoff:!1,subban:{stats:{played:p.subban.stats.played+STATS_OFFSET.SUBBAN.played,goals:p.subban.stats.goals+STATS_OFFSET.SUBBAN.goals,assists:p.subban.stats.assists+STATS_OFFSET.SUBBAN.assists,points:p.subban.stats.points+STATS_OFFSET.SUBBAN.points,plusMinus:p.subban.stats.plusMinus+STATS_OFFSET.SUBBAN.plusMinus},team:{},votes:ko.observable(l.subban.votes)},weber:{stats:{played:p.weber.stats.played+STATS_OFFSET.WEBER.played,goals:p.weber.stats.goals+STATS_OFFSET.WEBER.goals,assists:p.weber.stats.assists+STATS_OFFSET.WEBER.assists,points:p.weber.stats.points+STATS_OFFSET.WEBER.points,plusMinus:p.weber.stats.plusMinus+STATS_OFFSET.WEBER.plusMinus},team:{},votes:ko.observable(l.weber.votes)}};stats.seasons.unshift(p),stats.seasons.push(r),ko.applyBindings(stats),stats.isDataLoaded(!0)});function fetch(s){return $.ajax({type:"GET",url:s,dataType:"json"})}function mapPlayerDataToArray(s){for(var e=s[0].stats[0].splits,t=e.length-1,a=e[t];"National Hockey League"!==a.league.name;)a=e[t-1],t--;return{played:(a=a.stat).games,goals:a.goals,assists:a.assists,points:a.points,plusMinus:a.plusMinus}}function mapLeagueRegDataToArray(s,e,t){var a=s[0].records[e].teamRecords.filter(function(s){return s.team.id===t})[0],o=a.leagueRecord;return{wins:o.wins,losses:o.losses,otLosses:o.ot,points:a.points,status:""}}function mapPollToObject(s,e,t,a){var o=s-t,n=e-a,i=o/(o+n)*100;return{subban:{votes:{votes:o,percent:i=Math.round(i.toFixed(2))}},weber:{votes:{votes:n,percent:100-i}}}}function mapLeaguePlayoffDataToObject(s,e){var t=s[0].dates;if(t.length>0){var a=t[t.length-1].games[0].seriesSummary.series,o={wins:0,losses:0};return a.matchupTeams.forEach(function(s){s.team.id===e&&(o=s.seriesRecord)}),{wins:o.wins,losses:o.losses,otLosses:0,points:0,status:"Round "+a.round.number}}return{wins:0,losses:0,otLosses:0,points:0,status:""}}